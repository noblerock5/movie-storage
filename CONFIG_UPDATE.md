# 🔧 数据库配置更新说明

## 📋 更新内容

项目已更新为使用外部数据库和Redis服务，具体配置如下：

### 🐘 PostgreSQL 配置
- **服务器地址**: `43.143.233.242`
- **端口**: `5432`
- **数据库名**: `moviedb`
- **用户名**: `admin`
- **密码**: `admin123456`

### 🔴 Redis 配置
- **服务器地址**: `3.143.233.242`
- **端口**: `6379`
- **密码**: `admin123456`

## 📁 更新的文件

### 后端配置文件
1. **`backend/database.py`** - 默认数据库连接字符串
2. **`backend/main.py`** - Redis连接配置
3. **`backend/.env.example`** - 环境变量示例
4. **`backend/alembic.ini`** - 数据库迁移配置

### Docker 配置
1. **`docker-compose.yml`** - 移除本地数据库服务，使用外部服务

### 启动脚本
1. **`start.sh`** - Docker启动脚本，增加外部数据库检测
2. **`start_local.sh`** - 本地启动脚本，增加外部数据库检测

### 文档
1. **`README.md`** - 更新数据库配置说明

### 新增文件
1. **`test_db_connection.py`** - 数据库连接测试脚本

## 🚀 启动方式

### 方式一：Docker（推荐）
```bash
./start.sh
```

### 方式二：本地开发
```bash
./start_local.sh
```

### 方式三：测试连接
```bash
python3 test_db_connection.py
```

## 🔍 连接测试

在启动应用前，建议先测试数据库连接：

```bash
# 安装依赖
pip3 install psycopg2-binary redis

# 运行测试
python3 test_db_connection.py
```

预期输出：
```
🎬 电影网站数据库连接测试
==================================================
🔍 测试PostgreSQL连接...
✅ PostgreSQL连接成功!
   版本: PostgreSQL 15.x...
   现有表: []
🔍 测试Redis连接...
✅ Redis连接成功!
   测试读写: test_value
   Redis版本: 7.x...
   内存使用: 1.5M

==================================================
🎉 所有连接测试通过！
💡 提示：可以安全启动应用了
```

## ⚠️ 注意事项

### 网络连接
- 确保服务器能访问 `43.143.233.242` 和 `3.143.233.242`
- 检查防火墙是否允许相应的端口访问

### 数据库初始化
- 首次运行需要创建数据库表
- 运行 `backend/init_db.py` 初始化数据库

### 安全考虑
- 生产环境中请使用更安全的密码
- 考虑使用SSL连接数据库
- 定期备份数据库

## 🔧 故障排除

### PostgreSQL 连接失败
```bash
# 检查网络连通性
ping 43.143.233.242

# 使用psql测试连接
psql -h 43.143.233.242 -p 5432 -U admin -d moviedb
```

### Redis 连接失败
```bash
# 检查网络连通性
ping 3.143.233.242

# 使用redis-cli测试连接
redis-cli -h 3.143.233.242 -p 6379 -a admin123456 ping
```

### 应用启动失败
1. 检查数据库连接是否正常
2. 确认所有依赖已安装
3. 查看应用日志获取详细错误信息

## 📞 技术支持

如遇到连接问题，请检查：
1. 服务器地址和端口是否正确
2. 用户名和密码是否准确
3. 网络连接是否正常
4. 防火墙设置是否允许连接

---

**配置更新完成！** 🎉